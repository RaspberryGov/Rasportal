<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SunSwap Price Widget</title>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tronweb@4.5.1/dist/tronweb.min.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
    <style>
      body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }

      #root {
        width: 100%;
        max-width: 600px;  /* Increased max-width for the widget container */
        padding: 20px;
        box-sizing: border-box;
      }

      .price-widget {
        padding: 24px; /* Increased padding for better spacing */
        border-radius: 12px;  /* More rounded corners */
        background-color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  /* Slightly stronger shadow */
        text-align: center;
        transition: box-shadow 0.3s ease, transform 0.2s ease; /* Added smooth transitions */
        margin-bottom: 20px;
      }

      .price-widget:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);  /* Increased shadow on hover */
        transform: translateY(-4px);  /* Slight lift on hover */
      }

      .price-title {
        font-size: 1.5rem; /* Increased font size */
        font-weight: 600;  /* Use semibold font weight */
        margin-bottom: 16px; /* Increased margin */
        color: #2d3748; /* Darker heading color */
      }

      .loading-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px; /* Increased padding */
        color: #718096;
        font-size: 1.1rem;
      }

      .error-message {
        color: #e53e3e;
        background-color: #fed7d7;
        padding: 16px; /* Increased padding */
        border-radius: 8px; /* More rounded corners */
        border: 1px solid #f56565;
        margin-top: 16px; /* Increased margin */
        text-align: center;
      }

      .price-display {
        font-size: 2.5rem; /* Increased font size */
        font-weight: 700;  /* Use bold font weight */
        color: #1a202c; /* Very dark, almost black color */
        margin-bottom: 12px; /* Increased margin */
        letter-spacing: -0.02em;
      }

      .pair-info {
        font-size: 0.9rem;
        color: #a0aec0;
        margin-top: 8px;
        text-align: center;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const TronWeb = window.TronWeb;
      let tronWeb;

      const SunSwapPriceWidget = () => {
          const [price, setPrice] = React.useState(null);
          const [loading, setLoading] = React.useState(true);
          const [error, setError] = React.useState(null);
          const pairContractAddress = 'TM6fUHjWvB4kL91GiNTZrkDu5uzKEgGXoz';

          const pairContractABI = [
              {
                  "constant": true,
                  "inputs": [],
                  "name": "getReserves",
                  "outputs": [
                      { "internalType": "uint256", "name": "reserve0", "type": "uint256" },
                      { "internalType": "uint256", "name": "reserve1", "type": "uint256" },
                      { "internalType": "uint256", "name": "blockTimestampLast", "type": "uint256" }
                  ],
                  "payable": false,
                  "stateMutability": "view",
                  "type": "function"
              },
          ];

          React.useEffect(() => {
              const initializeTronWeb = async () => {
                  try {
                      if (window && (window as any).tronWeb) {
                          tronWeb = (window as any).tronWeb;
                      } else {
                        const HttpProvider = TronWeb.providers.HttpProvider;
                        const fullNode = new HttpProvider({ fullNode: 'https://api.trongrid.io' });
                        const solidityNode = new HttpProvider({ solidityNode: 'https://api.trongrid.io' });
                        const eventServer = new HttpProvider({ eventServer: 'https://api.trongrid.io' });
                        tronWeb = new TronWeb(fullNode, solidityNode, eventServer);
                      }

                      if (!tronWeb.defaultAddress) {
                          setError("TronWeb is not initialized.  Please ensure TronLink is installed and connected, or provide a default address.");
                          setLoading(false);
                          return;
                      }
                  } catch (e: any) {
                      setError(`Error initializing TronWeb: ${e.message}`);
                      setLoading(false);
                      return;
                  }
              };

              const fetchTokenPrice = async () => {
                  if (!tronWeb) {
                      return;
                  }
                  setLoading(true);
                  setError(null);
                  try {
                      const pairContract = await tronWeb.contract(pairContractABI, pairContractAddress);
                      const reserves = await pairContract.getReserves().call();
                      const reserve0 = reserves.reserve0.toNumber();
                      const reserve1 = reserves.reserve1.toNumber();

                      const decimals0 = 18;
                      const decimals1 = 18;


                      const calculatedPrice = (reserve1 * Math.pow(10, decimals0)) / (reserve0 * Math.pow(10, decimals1));
                      setPrice(calculatedPrice);
                  } catch (e: any) {
                      setError(`Error fetching price: ${e.message}`);
                  } finally {
                      setLoading(false);
                  }
              };

              initializeTronWeb().then(() => {
                  fetchTokenPrice();
                  const intervalId = setInterval(fetchTokenPrice, 10000);

                  return () => clearInterval(intervalId);
              });
          }, []);

          return (
              <div className="price-widget">
                  <h2 className="price-title">SunSwap Price</h2>
                  {loading ? (
                      <div className="loading-indicator">Loading price...</div>
                  ) : error ? (
                      <div className="error-message">{error}</div>
                  ) : price !== null ? (
                      <div className="price-display">
                          {price.toFixed(6)}
                      </div>
                  ) : (
                      <div className="text-gray-500">
                          Price not available.
                      </div>
                  )}
                  <div className="pair-info">
                      Trading Pair: {pairContractAddress}
                  </div>
              </div>
          );
      };

      function App() {
        return (
          <SunSwapPriceWidget />
        );
      }

      ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
